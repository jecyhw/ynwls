<!DOCTYPE html>
<html>
<head lang="en">
    <link href="../js/bootstrap/css/bootstrap.css" rel="stylesheet" media="screen">
    <meta charset="UTF-8">
    <title></title>
    <script src="../js/jquery.js"></script>
    <script src="../js/bootstrap/js/bootstrap.js"></script>
    <!--[if lt IE 9]><script src="../js/html5.js"></script><![endif]-->
</head>

<body>

<div>
    <div class="container" style="min-width: 1000px;">
        <div class="panel panel-primary">
            <!-- Default panel contents -->
            <div class="panel-heading">用户角色分配</div>
            <!-- Table -->
            <table class="table table-bordered table-hover table-condensed table-striped">
                <thead>
                <tr>
                    <th></th>
                    <th>用户账号</th>
                    <th>登录密码</th>
                    <th>姓名</th>
                    <th>生日</th>
                    <th>性别</th>
                    <th>工作单位</th>
                    <th>省,市,县</th>
                    <th>乡镇</th>
                    <th>注册时间</th>
                    <th>角色</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        <input type="checkbox" id="1" data-role="0">
                    </td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td data-role>Table cell</td>
                </tr>
                <tr>
                    <td><input type="checkbox" id="2" data-role="1"></td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td data-role>Table cell</td>
                </tr>
                <tr>
                    <td><input type="checkbox" id="3" data-role="2"></td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td data-role>Table cell</td>
                </tr>
                <tr>
                    <td><input type="checkbox"  id="4" data-role="0"></td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td data-role>Table cell</td>
                </tr>
                <tr>
                    <td><input type="checkbox"  id="5" data-role="0"></td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td data-role>Table cell</td>
                </tr>
                <tr>
                    <td><input type="checkbox" id="6" data-role="0"></td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td data-role>Table cell</td>
                </tr>
                <tr>
                    <td><input type="checkbox" id="7" data-role="0"></td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td data-role>Table cell</td>
                </tr>
                <tr>
                    <td><input type="checkbox" id="8" data-role="0"></td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td data-role>Table cell</td>
                </tr>
                <tr>
                    <td><input type="checkbox" id="9" data-role="0"></td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td data-role>Table cell</td>
                </tr>
                <tr>
                    <td><input type="checkbox" id="10" data-role="0"></td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td>Table cell</td>
                    <td data-role>Table cell</td>
                </tr>
                </tbody>
            </table>

            <div class="panel-body">
                <div class="row">
                    <div class="col-sm-4 col-xs-4">
                        <div>
                            <ul class="pagination" style="margin: 0px;">
                                <li>
                                    <a href="#" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                <li class="active"><a href="#">1</a></li>
                                <li><a href="#">2</a></li>
                                <li><a href="#">3</a></li>
                                <li><a href="#">4</a></li>
                                <li><a href="#">5</a></li>
                                <li>
                                    <a href="#" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-sm-4 col-xs-4">
                        <div class="dropdown">
                            <button class="btn btn-primary btn-sm dropdown-toggle" type="button" id="filter-role" data-toggle="dropdown" aria-expanded="true">
                                用户角色刷选
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="filter-role">
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)">管理员</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)">超级用户</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)">动物调查用户</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)">植物调查用户</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)">未分配角色</a></li>
                                <li role="presentation" class="disabled"  data-role="all"><a role="menuitem" tabindex="-1" href="javascript:void(0)">所有用户</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-sm-4 col-xs-4">
                        <div class="dropdown">
                            <button class="btn btn-primary btn-sm dropdown-toggle" type="button" id="edit-role" data-toggle="dropdown" aria-expanded="true">
                                角色修改 <span class="badge">0</span>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="edit-role">
                                <li  role="presentation" data-role="0"><a role="menuitem" tabindex="-1" onclick="edit(this,0)" href="javascript:void(0)">管理员</a></li>
                                <li role="presentation" data-role="1"><a role="menuitem" tabindex="-1" onclick="edit(this,1)" href="javascript:void(0)">超级用户</a></li>
                                <li role="presentation" data-role="2"><a role="menuitem" tabindex="-1" onclick="edit(this,2)" href="javascript:void(0)">动物调查用户</a></li>
                                <li role="presentation" data-role="3"><a role="menuitem" tabindex="-1" onclick="edit(this,3)" href="javascript:void(0)">植物调查用户</a></li>
                            </ul>
                            <button id="role-all" class="btn btn-info btn-sm">全选</button>
                            <button id="role-unselect" class="btn btn-info btn-sm">反选</button>
                            <button id="role-reset" class="btn btn-info btn-sm">重置</button>
                        </div>

                    </div>
                </div>
            </div>
            <div class="panel-body" id="role-edit-msg" style="display: none;">
                <div class="alert alert-danger text-center"><strong>操作失败,请稍后重试</strong></div>
            </div>
        </div>

    </div>
</div>
<script>
    var $edit_span;
    $(document).ready(function () {
        $edit_span = $("#edit-role").find(".badge");
        $edit_span.data("uid", "");
        $("table").on("click", "input[type=checkbox]", function() {
            var $span = $edit_span,
                    checked = parseInt($span.html()),
                    uid = $span.data("uid"),
                    id = $(this).attr("id");
            if ($(this).is(":checked")) {
                $span.html(checked + 1);
                if (uid) {
                    id = "," + id;
                }
                $span.data("uid", uid + id);
            } else {
                $span.html(checked - 1);
                $span.data("uid", uid.replace(new RegExp("," + id + "|^" + id + ",?"), ""));
            }
        }) ;

        $("#role-all").click(function () {
            $("table").find("input[type=checkbox]").each(function () {
                var $it = $(this);
                if (!$it.is(":checked")) {
                    $it.click();
                }
            }) ;
        });

        $("#role-reset").click(function () {
            $("table").find("input[type=checkbox]").each(function () {
                var $it = $(this);
                if ($it.is(":checked")) {
                    $it.click();
                }
            }) ;
        });

        $("#role-unselect").click(function () {
            $("table").find("input[type=checkbox]").each(function () {
                $(this).click();
            }) ;
        });

        $("#edit-role").click(function () {
            var uid = $edit_span.data("uid").split(","), role = undefined, i, len = 0;
            for (i = uid.length - 1; i >= 0; i--) {
                var id = uid[i];
                if (id.length > 0) {
                    len++;
                    if (role == undefined) {
                        role = $("#" + id).attr("data-role");
                    }
                    else if (role != $("#" + id).attr("data-role")) {
                        break;
                    }
                }
            }
            var $pa = $(this).parent(".dropdown");
            if (len == 0) {
                $pa.find("li").addClass("disabled");
            } else {
                $pa.find("li.disabled").removeClass("disabled");
                if (role != undefined && i < 0) {
                    $pa.find("li[data-role=" + role + "]").addClass("disabled");
                }
            }
        });
    });
    function edit(it, role) {
        if (!$(it).parent().hasClass("disabled")) {
            var $all = $("#filter-role").parent().find("li[data-role=all]");
            var uid = $edit_span.data("uid").split(",");
            if ($all.length == 0) {
                for (var i = uid.length - 1; i >= 0; i--) {
                    var id = uid[i];
                    if (id.length > 0) {
                        $("#" + id).parents("tr:first").fadeOut("slow", function () {
                            $(this).remove();
                        });
                    }
                }
            } else {
                var roleText = $(it).html();
                for (var i = uid.length - 1; i >= 0; i--) {
                    var id = uid[i];
                    if (id.length > 0) {
                        $("#" + id).attr("data-role", role).parents("tr:first").find("td[data-role]").fadeOut("slow", function () {
                            $(this).html(roleText).fadeIn("slow");
                        });
                    }
                }
            }
            $("#role-reset").click();

            $("#role-edit-msg").slideUp("slow", function () {
                $(this).slideDown("slow");
            });
        }

        $("tbody").hide().fadeIn();
    }
</script>
</body>
</html>